---
import { SEO } from "astro-seo";
import { getLangFromUrl } from '../i18n/utils';

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  noindex?: boolean;
  nofollow?: boolean;
}

const {
  title = "TailKits Astro - Modern Starter Theme",
  description = "A modern, beautiful Astro starter theme with Tailwind CSS. Perfect for building fast, responsive websites.",
  image = "/og-image.jpg",
  canonical = Astro.url.href,
  noindex = false,
  nofollow = false
} = Astro.props;

// Get current language
const lang = getLangFromUrl(Astro.url);

// Import the global CSS file
import '../styles/global.css';
import Banner from '../components/Banner.astro';
import Navigation from '../components/Navigation.astro';
---

<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<style>
			html, body {
				background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
				margin: 0;
				padding: 0;
			}
		</style>
		<SEO
			title={title}
			description={description}
			canonical={canonical}
			noindex={noindex}
			nofollow={nofollow}
			openGraph={{
				basic: {
					title: title,
					type: "website",
					image: image,
					url: canonical,
				},
				optional: {
					description: description,
					siteName: "TailKits Astro",
				},
			}}
			twitter={{
				card: "summary_large_image",
				site: "@tailkits",
				creator: "@tailkits",
				title: title,
				description: description,
				image: image,
			}}
			extend={{
				link: [
					{ rel: "icon", type: "image/svg+xml", href: "/favicon.svg" },
					{ rel: "preconnect", href: "https://fonts.googleapis.com" },
					{ rel: "preconnect", href: "https://fonts.gstatic.com", crossorigin: true },
					{ rel: "stylesheet", href: "https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" },
				],
				meta: [
					{ name: "viewport", content: "width=device-width, initial-scale=1.0" },
					{ name: "generator", content: Astro.generator },
					{ name: "theme-color", content: "#0f172a" },
					{ name: "color-scheme", content: "light dark" },
				],
			}}
		/>
		<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
		<script is:inline>
			// Automatic language detection based on browser preferences
			(function() {
				// Only run on first visit (check if user has made a language choice)
				const hasUserChoice = localStorage.getItem('yt-lang-choice');
				if (hasUserChoice) return;

				// Get current path and language
				const path = window.location.pathname;

				// Skip language detection for admin pages
				if (path.startsWith('/admin')) return;

				const isZhPage = path.startsWith('/zh');
				const isEnPage = !isZhPage; // English is default (no prefix)

				// Get browser language
				const browserLang = navigator.language || navigator.userLanguage;
				const prefersChinese = browserLang.toLowerCase().startsWith('zh');

				// Redirect if needed
				if (prefersChinese && isEnPage) {
					// User prefers Chinese but on English page - redirect to Chinese
					const newPath = '/zh' + (path === '/' ? '' : path);
					window.location.replace(newPath);
				} else if (!prefersChinese && isZhPage) {
					// User prefers English but on Chinese page - redirect to English
					const newPath = path.replace(/^\/zh/, '') || '/';
					window.location.replace(newPath);
				}

				// Mark that auto-detection has been done (user can still switch manually)
				sessionStorage.setItem('yt-lang-auto', 'true');
			})();
		</script>
	</head>
	<body class="text-gray-900">
		<div class="relative min-h-screen">
			<img
			  class="absolute left-0 top-0 -z-20 h-full w-full object-cover"
			  src="https://tailkits.com/ui/iframe/assets/img/bg-12.png"
			  alt="Background image"
			  loading="eager"
			  decoding="async"
			/>
			<Banner />
			<Navigation />
			<slot />
		</div>
	</body>
</html>
